<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="profMapper">

	<!-- 교수 -->
	<resultMap id="profResultSet" type="Professor">
		<id property="profId" column="PROF_ID"/>
		<result property="profPwd" column="PROF_PWD"/>
		<result property="profName" column="PROF_NAME"/>
		<result property="profDept" column="DEPT_CODE"/>
		<result property="profDeptTitle" column="DEPT_TITLE"/>
		<result property="profRrn" column="PROF_RRN"/>
		<result property="profEmail" column="PROF_EMAIL"/>
		<result property="profPhone" column="PROF_PHONE"/>
		<result property="profAddress" column="PROF_ADDRESS"/>
		<result property="profStatus" column="PROF_STATUS"/>
		<result property="profEmpdate" column="PROF_EMPDATE"/>
	</resultMap>
	
	<!-- 강의 -->
	<resultMap id="profSubResultSet" type="Subject">
		<id property="subCode" column="SUB_CODE"/>
		<result property="subTitle" column="SUB_TITLE"/>
		<result property="deptCode" column="DEPT_CODE"/>
		<result property="subDivs" column="SUB_DIVS"/>
		<result property="profId" column="PROF_ID"/>
		<result property="subCredit" column="SUB_CREDIT"/>
		<result property="subClass" column="SUB_CLASS"/>
		<result property="subTime" column="SUB_TIME"/>
		<result property="subType" column="SUB_TYPE"/>
		<result property="subYear" column="SUB_YEAR"/>
		<result property="subSmst" column="SUB_SMST"/>
		<result property="status" column="STATUS"/>
	</resultMap>
	
	<!-- 학생 -->
	<resultMap type="Student" id="profStuResultSet">
		<id property="stuId" column="STU_ID"/>
		<result property="deptTitle" column="DEPT_TITLE"/>	
		<result property="profId" column="PROF_ID"/>	
		<result property="stuName" column="STU_NAME"/>	
		<result property="email" column="EMAIL"/>	
		<result property="phone" column="PHONE"/>	
		<result property="stuStatus" column="STU_STATUS"/>	
		<result property="year" column="YEAR"/>
		<result property="semester" column="SEMESTER"/>
	</resultMap>
	
	<!-- 상담 -->
	<resultMap type="Consult" id="consultResultSet">
		<id property="conNo" column="CON_NO"/>
		<result property="conCategory" column="CON_CATEGORY"/>	
		<result property="conDate" column="CON_DATE"/>	
		<result property="conReason" column="CON_REASON"/>	
		<result property="rejectReason" column="REJECT_REASON"/>	
		<result property="status" column="STATUS"/>	
		<result property="stuId" column="STU_ID"/>
		<!-- 학생이름, 제목, 내용 상담 객체에 추가 -->	
	</resultMap>
	
	<!-- 강의평가 -->
	<resultMap type="Evaluation" id="evalResultSet">
		<id property="lectEvaNo" column="LECT_EVA_NO"/>
		<result property="question" column="QUESTION"/>
		<result property="score" column="SCORE"/>
		<!-- <result property="year" column="YEAR"/>
		<result property="semester" column="SEMESTER"/> -->
	</resultMap>
	
	<!-- 자퇴 -->
	<resultMap type="StudentDo" id="doStatusResultSet">
		<id property="applicationNo" column="APPLICATION_NO"/>
		<result property="stuId" column="STU_ID"/>
		<result property="doDate" column="DO_DATE"/>
		<result property="doReason" column="DO_REASON"/>
		<result property="status" column="STATUS"/>
		<result property="stuName" column="STU_NAME"/>
		<result property="stuStatus" column="STU_STATUS"/>
	</resultMap>
	
	<!-- 휴학 -->
	<resultMap type="StudentOff" id="offStatusResultSet">
		<id property="applicationNo" column="APPLICATION_NO"/>
		<result property="stuId" column="STU_ID"/>
		<result property="offCategory" column="OFF_CATEGORY"/>
		<result property="offDate" column="OFF_DATE"/>
		<result property="offSemCnt" column="OFF_SEM_CNT"/>
		<result property="offSem" column="OFF_SEM"/>
		<result property="offReason" column="OFF_REASON"/>
		<result property="status" column="STATUS"/>
		<result property="stuName" column="STU_NAME"/>
		<result property="stuStatus" column="STU_STATUS"/>
	</resultMap>
	
	<!-- 강의 신청 -->
	<resultMap type="RequestedSubject" id="reqSubResultSet">
		<id property="reqSubNo" column="REQSUB_NO"/>
		<result property="deptCode" column="DEPT_CODE"/>
		<result property="subDivs" column="SUB_DIVS"/>
		<result property="subType" column="SUB_TYPE"/>
		<result property="subTitle" column="SUB_TITLE"/>
		<result property="profId" column="PROF_ID"/>
		<result property="subCredit" column="SUB_CREDIT"/>
		<result property="subTime" column="SUB_TIME"/>
		<result property="status" column="STATUS"/>
	</resultMap>
	
	<!-- 로그인 교수 -->
	<select id="loginProfessor" parameterType="Professor" resultMap="profResultSet">
		SELECT * FROM PROFESSOR
		WHERE PROF_ID=#{profId} AND PROF_STATUS='Y'
	</select>
	
	
	
	<!-- 마이페이지 -->
	<!-- 교수 마이페이지 개인정보 조회 -->
	<select id="selectMypage" parameterType="Professor" resultMap="profResultSet">
		SELECT PROF_ID, PROF_NAME, DEPT_TITLE, PROF_EMAIL, PROF_PHONE, PROF_ADDRESS
		FROM PROFESSOR
		JOIN DEPARTMENT USING (DEPT_CODE)
		WHERE PROF_ID=#{profId} AND PROF_STATUS='Y'
	</select>
	
	<!-- 교수 마이페이지 개인정보 수정 -->
	<update id="editMypage" parameterType="Professor">
		UPDATE PROFESSOR
		SET PROF_PWD=#{profPwd}, PROF_EMAIL=#{profEmail}, PROF_PHONE=#{profPhone}, PROF_ADDRESS=#{profAddress}
		WHERE PROF_ID=#{profId} AND PROF_STATUS='Y'
	</update>
	
	
	
	<!-- 강의관리 -->
	<!-- 강의개설 -->
	<!-- 학과명, 교수명 불러오기 -->
	<select id="profInfoLoad" parameterType="Professor" resultMap="profResultSet">
		SELECT DEPT_TITLE, PROF_NAME
		FROM PROFESSOR
		JOIN DEPARTMENT USING(DEPT_CODE)
		WHERE PROF_ID=#{profId}
	</select>
	<!-- 과목정보 불러오기 -->
	<select id="subInfoLoad" parameterType="Map" resultMap="profSubResultSet">
		SELECT SUB_DIVS, SUB_TYPE, SUB_TITLE, SUB_CREDIT, SUB_TIME
		FROM SUBJECT
		WHERE PROF_ID=#{profId} AND SUB_CODE=#{subCode}
	</select>
	
	<!-- 강의개설 신청 -->
	<insert id="profCreateLecture" parameterType="RequestedSubject">
		INSERT INTO REQ_SUBJECT
		VALUES (SEQ_REQSUB_NO.NEXTVAL, #{deptCode}, #{subDivs}, #{subType}, #{subTitle}, #{profId},
				#{subCredit}, #{subTime}, DEFAULT)
	</insert>
	
	<!-- 강의목록 조회 -->
	<!-- 교수 강의목록 개수 -->
	<select id="subListCount" resultType="_int">
		SELECT COUNT(*)
		FROM SUBJECT
		WHERE PROF_ID=#{profId}
	</select>
	
	<!-- 교수 강의목록 불러오기 -->
	<select id="selectSubList" resultMap="profSubResultSet">
		SELECT SUB_CODE, SUB_TITLE, SUB_DIVS, SUB_CREDIT, SUB_CLASS, SUB_TIME, SUB_TYPE
		FROM SUBJECT
		JOIN PROFESSOR USING(PROF_ID)
		WHERE PROF_ID=#{profId}
		ORDER BY SUB_YEAR DESC, SUB_SMST DESC
	</select>
	
	<!-- 강의수정 -->
	
	
	<!-- 강의정보 수정 -->

	
	<!-- 강의삭제 -->
	
	<!-- 강의개설/수정/삭제 목록 -->
	<select id="reqSubListCount" resultType="_int">
		SELECT COUNT(*)
		FROM REQ_SUBJECT
		WHERE PROF_ID=#{profId}
	</select>
	<select id="selectReqSubList" resultMap="reqSubResultSet">
		SELECT SUB_DIVS, SUB_TYPE, SUB_TITLE, SUB_CREDIT, SUB_TIME, STATUS
		FROM REQ_SUBJECT
		WHERE PROF_ID=#{profId}
		ORDER BY REQSUB_NO DESC
	</select>
	
	<!-- 학생관리 -->
	<!-- 학생목록조회 -->
	<!-- 강의별 학생목록 불러오기 -->
	<select id="profStudentDetail" resultMap="profStuResultSet">
		SELECT B.DEPT_TITLE, A.STU_ID, A.STU_NAME, A.STU_STATUS, A.EMAIL, A.PHONE
		FROM STUDENT A
		JOIN DEPARTMENT B ON A.DEPT_CODE=B.DEPT_CODE
		JOIN LECT_REGISTER C ON A.STU_ID=C.STU_ID
		JOIN SUBJECT D ON C.SUB_CODE=D.SUB_CODE
		WHERE C.SUB_CODE=#{subCode} AND C.YEAR=#{year} AND C.SEMESTER=#{semester} AND D.PROF_ID=#{profId}
		ORDER BY A.DEPT_CODE
	</select>
	
	<!-- 학생상담관리 -->
	<select id="loadConsultList" resultMap="consultResultSet">
		SELECT CON_NO, CON_CATEGORY, CON_DATE, CON_REASON, REJECT_REASON, STATUS, STU_ID
		FROM CONSULT
		JOIN STUDENT USING(STU_ID)
		WHERE PROF_ID=#{profId}
		ORDER BY CON_NO DESC
	</select>
	
	<!-- 학생출결관리 -->
	
	<!-- 강의평가조회 -->
	<select id="loadEvalList" resultMap="evalResultSet">
		SELECT QUESTION, SCORE
		FROM LECT_EVALUATE A
		JOIN LECT_REGISTER B USING(LECT_REG_NO)
		WHERE B.SUB_CODE=#{subCode} AND B.YEAR=#{subYear} AND B.SEMESTER=#{subSmst}
		ORDER BY A.LECT_EVA_NO DESC
	</select>
	
	<!-- 학적변동승인 -->
	<!-- 자퇴 -->
	<select id="doListCount" resultType="_int">
		SELECT COUNT(*)
		FROM STU_DO
		JOIN STUDENT USING(STU_ID)
		WHERE PROF_ID=#{profId}
	</select>
	<select id="loadDoList" resultMap="doStatusResultSet" parameterType="StudentDo">
		SELECT C.STU_NAME, B.DO_DATE, C.STU_STATUS, B.DO_REASON, A.STS_PROCESS
		FROM STU_STATUS_PRO A
		JOIN STU_DO B ON A.APPLICATION_NO_DO=B.APPLICATION_NO
		JOIN STUDENT C ON C.STU_ID=B.STU_ID
		WHERE C.PROF_ID=#{profId}
		ORDER BY B.APPLICATION_NO DESC
	</select>
	
	<!-- 휴학 -->
	<select id="offListCount" resultType="_int">
		SELECT COUNT(*)
		FROM STU_OFF
		JOIN STUDENT USING(STU_ID)
		WHERE PROF_ID=#{profId}
	</select>
	<select id="loadOffList" resultMap="offStatusResultSet">
		SELECT C.STU_NAME, B.OFF_DATE, C.STU_STATUS, B.OFF_CATEGORY, B.OFF_SEM_CNT, B.OFF_SEM, B.OFF_REASON, A.STS_PROCESS
		FROM STU_STATUS_PRO A
		JOIN STU_OFF B ON A.APPLICATION_NO_OFF=B.APPLICATION_NO
		JOIN STUDENT C ON C.STU_ID=B.STU_ID
		WHERE C.PROF_ID=#{profId}
		ORDER BY B.APPLICATION_NO DESC
	</select>
	
<!-- 	<select id="studentProList" resultMap="studentStatusResultMap" parameterType="string">
		SELECT STU_STATUS_PRO.STS_PROCESS, STU_STATUS_PRO.STS_CATEGORY, STU_STATUS_PRO.STS_COMPLETE, STU_STATUS_PRO.STATUS, APPLICATION_NO_OFF,APPLICATION_NO_DO
		FROM STU_STATUS_PRO
		LEFT JOIN STU_OFF ON STU_STATUS_PRO.APPLICATION_NO_OFF = STU_OFF.APPLICATION_NO
		LEFT JOIN STU_DO ON STU_STATUS_PRO.APPLICATION_NO_DO = STU_DO.APPLICATION_NO
		WHERE  STU_STATUS_PRO.STATUS = 'Y'
		AND (STU_OFF.STU_ID = #{stuId} OR STU_DO.STU_ID = #{stuId})
	</select> -->
	
	
</mapper>